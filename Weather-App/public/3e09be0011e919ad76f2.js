import"./styles.css";let input=document.querySelector(".form-side .input"),submit=document.querySelector(".form-side .add"),tasksDiv=document.querySelector(".form-side .tasks"),mainDiv=document.querySelector(".main"),container=document.querySelector(".container"),formAddTask=document.querySelector(".form-add-task"),modal=document.querySelector(".modal-form");const projects=JSON.parse(localStorage.getItem("main"))||[];let arrayOfTasks=JSON.parse(localStorage.getItem("tasks"))||[];function addTaskToArray(e){const t={id:Date.now(),title:e,completed:!1};arrayOfTasks.push(t),updateLocalStorage(),renderTasks(arrayOfTasks)}function renderTasks(e){tasksDiv.innerHTML="",e.forEach((e=>{let t=document.createElement("div");t.className="task",t.setAttribute("data-id",e.id),t.textContent=e.title;let a=document.createElement("span");a.className="addtask",a.textContent="Add",a.addEventListener("click",(e=>{document.querySelectorAll(".task").forEach((e=>{e.classList.remove("active")})),e.target.parentElement.classList.toggle("active"),openTaskModal(e.target.parentElement.getAttribute("data-id"))}));let o=document.createElement("span");o.className="del",o.textContent="Delete",t.append(a,o),tasksDiv.appendChild(t)}))}function updateLocalStorage(){localStorage.setItem("tasks",JSON.stringify(arrayOfTasks))}function updateLocalStoragebox(){projects.length&&localStorage.setItem("main",JSON.stringify(projects))}function getDataFromLocalStorage(){renderTasks(arrayOfTasks)}function deleteTask(e){console.log(projects.ids),console.log(e),arrayOfTasks=arrayOfTasks.filter((t=>t.id!=e)),projects.splice(projects.findIndex((t=>t.ids===e)),1),document.querySelectorAll(".box").forEach((t=>{t.getAttribute("data-id")==e&&(t.remove(),deleteTaskbox(t.getAttribute("data-id")))})),updateLocalStorage(),updateLocalStoragebox()}function deleteTaskbox(e){projects.forEach((t=>{console.log(t),t.boxs=t.boxs.filter((t=>t.data!=e))})),updateLocalStoragebox()}function openTaskModal(e){modal.style.display="flex",modal.setAttribute("data-id",e)}function renderProjectTasks(e,t){mainDiv.innerHTML="",e.boxs.forEach((e=>{let a=document.createElement("div");a.className="box",a.setAttribute("data-id",t);let o=document.createElement("div");o.className="option","High"===e.priority?o.style.backgroundColor="red":"Medium"===e.priority?o.style.backgroundColor="yellow":"Low"===e.priority&&(o.style.backgroundColor="green");let r=document.createElement("h1");r.className="title",r.textContent=e.title;let s=document.createElement("p");s.className="description",s.textContent=e.description;let n=document.createElement("p");n.className="date",n.textContent=e.dueDate;let l=document.createElement("div");l.className="buttons";let i=document.createElement("button");i.className="checked",i.textContent="UnChecked";let d=document.createElement("button");d.className="delete",d.textContent="Delete",d.addEventListener("click",(()=>{a.remove(),deleteTaskbox(e.data)})),i.addEventListener("click",(t=>{t.target.classList.contains("checked")&&a.classList.toggle("done"),i.classList.toggle("completed"),i.classList.contains("completed")?(r.style.textDecoration="line-through",s.style.textDecoration="line-through",n.style.textDecoration="line-through",setTimeout((()=>{a.remove(),deleteTaskbox(e.data)}),1e3)):(r.style.textDecoration="none",s.style.textDecoration="none",n.style.textDecoration="none"),updateLocalStoragebox()})),l.append(i,d,o),a.append(r,s,n,l),mainDiv.appendChild(a)}))}getDataFromLocalStorage(),submit.onclick=function(){""!==input.value.trim()&&(addTaskToArray(input.value.trim()),input.value="")},tasksDiv.addEventListener("click",(e=>{e.target.classList.contains("del")&&(deleteTask(e.target.parentElement.getAttribute("data-id")),e.target.parentElement.remove())})),formAddTask.addEventListener("submit",(e=>{e.preventDefault();let t=formAddTask.querySelector("input[name='title']").value.trim(),a=formAddTask.querySelector("textarea[name='description']").value.trim(),o=formAddTask.querySelector("input[name='date']").value.trim(),r=document.querySelector("select[name='priority']").value.trim(),s=Date.now(),n=modal.getAttribute("data-id");if(r="Medium"===r?"Medium":"Low"===r?"Low":"High",!(t&&a&&o&&r))return;let l=projects.find((e=>String(e.ids)===String(n)))||{ids:n,boxs:[]};projects.includes(l)||projects.push(l),l.boxs.some((e=>e.title===t&&e.description===a))||l.boxs.push({title:t,description:a,dueDate:o,priority:r,data:s}),updateLocalStoragebox(),modal.style.display="none",formAddTask.reset(),renderProjectTasks(l,n)}));